<!doctype html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8"/>
<title>婚禮問答 Display</title>
<style>
body{background:#0b1220;color:#e5e7eb;font-family:system-ui;margin:0}
.wrap{padding:24px}
.choice{border:2px solid #334155;border-radius:14px;padding:16px;margin:10px 0}
.choice.good{border-color:#22c55e;box-shadow:0 0 0 2px rgba(34,197,94,.25)}
.choice.bad{border-color:#64748b;opacity:.55}
</style>
</head>
<body>
<div class="wrap">
  <h1 id="room"></h1>
  <h2 id="q">等待題目…</h2>
  <div id="choices"></div>
</div>

<script src="/socket.io/socket.io.js"></script>
<script>
const $ = (id)=>document.getElementById(id);
const socket = io();

let state="lobby";
let correctIndex=null;
let labels=["A","B","C","D"];

function renderQuestion(q){
  $("q").textContent = q.text;
  $("choices").innerHTML="";
  q.choices.forEach((c,i)=>{
    const d=document.createElement("div");
    d.className="choice";
    d.textContent=labels[i]+" "+c;
    if(state==="reveal" && typeof correctIndex==="number"){
      if(i===correctIndex) d.classList.add("good");
      else d.classList.add("bad");
    }
    $("choices").appendChild(d);
  });
}

socket.on("room:update",(s)=>{
  $("room").textContent = s.code || "";
  state = s.state;
  if(typeof s.correctIndex==="number") correctIndex = s.correctIndex;

  if(state==="ended"){
    $("q").textContent="等待結果揭曉";
    $("choices").innerHTML="";
    return;
  }
  if(s.question){
    renderQuestion(s.question);
  }
});

socket.on("question:reveal",(p)=>{
  state="reveal";
  correctIndex = p.correctIndex;
  if(p.question) renderQuestion(p.question);
});
</script>
</body>
</html>
